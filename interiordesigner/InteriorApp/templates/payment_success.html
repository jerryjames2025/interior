{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block body %}
<div class="container mt-5 mb-5">
    <div class="card shadow-lg">
        <div class="card-body">
            <div class="text-center mb-4">
                <h2>My Orders</h2>
            </div>

            {% if orders_with_items %}
                {% for order_data in orders_with_items %}
                <div class="order-container mb-4 animate-fade-in">
                    <div class="card border-0 bg-light">
                        <!-- Order Header -->
                        <div class="card-header bg-white border-0">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-0">Order #{{ order_data.order.id }}</h5>
                                    <small class="text-muted">Placed on: {{ order_data.order.created_at|date:"F d, Y, g:i A" }}</small>
                                </div>
                                <div class="order-status">
                                    <span class="badge {% if order_data.order.status == 'Completed' %}bg-success
                                          {% elif order_data.order.status == 'Processing' %}bg-info
                                          {% elif order_data.order.status == 'Pending' %}bg-warning
                                          {% else %}bg-danger{% endif %}">
                                        {{ order_data.order.status }}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Order Items -->
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Product</th>
                                            <th>Quantity</th>
                                            <th class="text-end">Price</th>
                                            <th class="text-end">Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in order_data.items %}
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <img src="{{ item.product.image.url }}" alt="{{ item.product.product_name }}" 
                                                         class="img-thumbnail me-3" style="width: 50px; height: 50px; object-fit: cover;">
                                                    <div>
                                                        <h6 class="mb-0">{{ item.product.product_name }}</h6>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>{{ item.quantity }}</td>
                                            <td class="text-end">₹{{ item.price }}</td>
                                            <td class="text-end">₹{{ item.total }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                    <tfoot class="table-light">
                                        <tr>
                                            <td colspan="3" class="text-end"><strong>Subtotal:</strong></td>
                                            <td class="text-end">₹{{ order_data.subtotal }}</td>
                                        </tr>
                                        <tr>
                                            <td colspan="3" class="text-end"><strong>Delivery Charges:</strong></td>
                                            <td class="text-end">₹{{ order_data.delivery_charge }}</td>
                                        </tr>
                                        <tr>
                                            <td colspan="3" class="text-end"><strong>Total:</strong></td>
                                            <td class="text-end"><strong>₹{{ order_data.total }}</strong></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>

                            <!-- Payment Details -->
                            <div class="mt-4">
                                <h6>Payment Information</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p class="mb-1"><small>Payment ID: <span class="text-monospace">{{ order_data.order.payment_id }}</span></small></p>
                                        {% if order_data.order.razorpay_order_id %}
                                        <p class="mb-1"><small>Razorpay Order ID: <span class="text-monospace">{{ order_data.order.razorpay_order_id }}</span></small></p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Shipping Details -->
                            {% if order_data.order.shipping_address %}
                            <div class="mt-4">
                                <h6>Shipping Details</h6>
                                <p class="mb-1">{{ order_data.order.shipping_address }}</p>
                                {% if order_data.order.contact_number %}
                                <p class="mb-0">Contact: {{ order_data.order.contact_number }}</p>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-shopping-bag fa-3x text-muted mb-3"></i>
                    <h4>No Orders Found</h4>
                    <p class="text-muted">Looks like you haven't placed any orders yet.</p>
                    <a href="{% url 'products' %}" class="btn btn-primary mt-3">Start Shopping</a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .animate-fade-in {
        animation: fadeIn 0.5s ease-out forwards;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .success-icon {
        animation: scaleIn 0.5s ease-in-out;
    }
    
    @keyframes scaleIn {
        from { transform: scale(0); }
        to { transform: scale(1); }
    }
    
    .badge {
        padding: 8px 16px;
        border-radius: 20px;
    }
    
    .text-monospace {
        font-family: monospace;
        background: #f8f9fa;
        padding: 2px 6px;
        border-radius: 4px;
    }
    
    @media print {
        .btn { display: none; }
        .card { box-shadow: none !important; }
    }
</style>
{% endblock %} 